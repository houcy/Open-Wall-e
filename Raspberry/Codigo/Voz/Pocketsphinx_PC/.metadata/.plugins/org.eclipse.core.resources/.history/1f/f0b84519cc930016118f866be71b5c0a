//============================================================================
// Name        : Reconocimiento_voz.cpp
// Author      : Maximo Fernandez Nuñez
// Version     :
// Copyright   : Your copyright notice
// Description : Hello World in C++, Ansi-style
//============================================================================

#include <iostream>
#include <pocketsphinx.h>
#include "../Resources/Defines.h"
#include "../Resources/Resources.h"
#include "../src/Utilities.h"
//#include <sphinxbase/err.h>
//#include <sphinxbase/ad.h>
//#include <stdio.h>
//#include <string.h>
//#include <assert.h>
//#include <sys/select.h>
using namespace std;



int main(int argc, char *argv[])
{
	//ps_decoder_t *ps = NULL;
	//cmd_ln_t *config = NULL;
	char const *cfg_argfile, *cfg_infile;
	bool cfg_inmic;
	char sTmp[255];

	sprintf(sTmp,"\n\r (Reconocimiento Voz) !!!Reconocimiento de voz con pocketsphinx!!!");
	trace (sTmp);
	sprintf(sTmp,"\n\r (Reconocimiento Voz) Directorio de ejecucion del programa: ");
	trace (sTmp);
	trace (get_ProgramDirectory());

	// Configuración en función de los argumentos de entrada
	config = cmd_ln_parse_r(NULL, cont_args_def, argc, argv, TRUE);

	/* Handle argument file as -argfile. */
	/* Identificador de archivo como argumento -argfile. */
	cfg_argfile = cmd_ln_str_r(config, "-argfile");
	if (config && cfg_argfile != NULL) {
		config = cmd_ln_parse_file_r(config, cont_args_def, cfg_argfile, FALSE);
	}

	/* Comprobacion de argumentos de entrada correctos */
	cfg_infile = cmd_ln_str_r(config, "-infile");
	cfg_inmic = cmd_ln_boolean_r(config, "-inmic");
    if (config == NULL || (cfg_infile == NULL && cfg_inmic == FALSE)) {
    	E_INFO("Specify '-infile <file.wav>' to recognize from file "
    			"or '-inmic yes' to recognize from microphone.\n");
    	trace ("\n\r");
    	trace ("\n\r");
        cmd_ln_free_r(config);
        return 1;
    }

    ps_default_search_args(config);
    ps = ps_init(config);
    if (ps == NULL) {
        cmd_ln_free_r(config);
        return 1;
    }

    E_INFO("%s COMPILED ON: %s, AT: %s\n\n", argv[0], __DATE__, __TIME__);

    if (cmd_ln_str_r(config, "-infile") != NULL) {
        recognize_from_file();
    } else if (cmd_ln_boolean_r(config, "-inmic")) {
        recognize_from_microphone();
    }

    ps_free(ps);
    cmd_ln_free_r(config);

	trace ("\n\r");
	trace ("\n\r");
	return 0;
}

